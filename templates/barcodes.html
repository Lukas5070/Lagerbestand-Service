<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Etiketten â€“ QR Avery L4743REV</title>
  <style>
    @page {
      size: A4;
      margin: 0;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      font-size: 12px;
      overflow: hidden;
    }

    .seite {
      height: 297mm;
      width: 210mm;
      padding: 21.5mm 7mm;
      box-sizing: border-box;
      display: grid;
      grid-template-columns: repeat(2, 99.1mm);
      grid-template-rows: repeat(6, 42.3mm);
      gap: 0mm 2.5mm;
      page-break-after: always;
    }

    .etikett {
      box-sizing: border-box;
      padding: 3mm 2mm;
      text-align: center;
      overflow: hidden;
    }

    .etikett img {
      height: 32mm;
      max-width: 100%;
      margin: 2mm 0 1mm;
    }

    @media print {
      .noprint { display: none; }
    }

    .noprint {
      margin: 10px;
    }

    .neu-artikel {
      margin: 20px 10px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .neu-artikel img {
      height: 50px;
      vertical-align: middle;
      margin-right: 10px;
    }

    .neu-artikel h2 {
      margin-top: 0;
    }

    .neu-eintrag {
      margin-bottom: 10px;
    }

    .neu-eintrag small {
      color: #666;
      font-size: 10px;
    }

    .druckbereich {
      display: block;
    }

    .druckbereich.ausblenden {
      display: none;
    }

    .etikett input[type="checkbox"] {
      margin-top: 5px;
    }

    .etikett.ausgeblendet {
      display: none;
    }

    #suchfeld {
      width: 300px;
      padding: 5px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <!-- Steuerelemente -->
  <div class="noprint">
    <a href="/" style="padding:6px 12px; background:#007BFF; color:#fff; text-decoration:none; border-radius:5px;">â¬… ZurÃ¼ck</a>
    <input type="text" id="suchfeld" placeholder="ğŸ” Artikel suchen..." onkeyup="filterEtiketten()">
    <button onclick="zeigeNurNeue()" style="padding:6px 12px; background:#17a2b8; color:#fff; border:none; border-radius:5px;">ğŸ†• Nur neue drucken</button>
    <button onclick="zeigeAlle()" style="padding:6px 12px; background:#6c757d; color:#fff; border:none; border-radius:5px;">ğŸ“¦ Alle anzeigen</button>
    <button onclick="zeigeAuswahl()" style="padding:6px 12px; background:#ffc107; color:#000; border:none; border-radius:5px;">âœ… Nur Auswahl drucken</button>
    <button onclick="window.print()" style="padding:6px 12px; background:#28a745; color:#fff; border:none; border-radius:5px;">ğŸ–¨ï¸ Jetzt drucken</button>
    <p style="margin-top:10px;">Druckeinstellungen: A4 Â· 100â€¯% Â· Keine RÃ¤nder Â· Hintergrundgrafiken âœ…</p>
  </div>

  <!-- Zuletzt hinzugefÃ¼gte Artikel -->
  <div class="noprint neu-artikel">
    <h2>ğŸ†• Zuletzt hinzugefÃ¼gte Artikel</h2>
    {% if neue_artikel %}
      {% for art in neue_artikel %}
        <div class="neu-eintrag">
          <img src="{{ url_for('static', filename='barcodes/' + art.barcode_filename) }}" alt="Barcode">
          <strong>{{ art.name }}</strong><br>
          <small>ID: {{ art.barcode_filename[:-4] }} | HinzugefÃ¼gt: {{ art.created_at.strftime('%d.%m.%Y %H:%M') if art.created_at else 'â€“' }}</small>
        </div>
      {% endfor %}
    {% else %}
      <p>Keine neuen Artikel gefunden.</p>
    {% endif %}
  </div>

  <!-- Etiketten â€“ Neue Artikel -->
  <div id="nur-neue" class="druckbereich ausblenden">
    {% for i in range(0, neue_artikel|length, 12) %}
      <div class="seite">
        {% for art in neue_artikel[i:i+12] %}
          <div class="etikett">
            <strong>{{ art.name }}</strong><br>
            <img src="{{ url_for('static', filename='barcodes/' + art.barcode_filename) }}"><br>
            <small>{{ art.barcode_filename[:-4] }}</small><br>
            <input type="checkbox" class="checkbox-auswahl">
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <!-- Etiketten â€“ Alle Artikel -->
  <div id="alle-artikel" class="druckbereich">
    {% for i in range(0, artikel|length, 12) %}
      <div class="seite">
        {% for art in artikel[i:i+12] %}
          <div class="etikett">
            <strong>{{ art.name }}</strong><br>
            <img src="{{ url_for('static', filename='barcodes/' + art.barcode_filename) }}"><br>
            <small>{{ art.barcode_filename[:-4] }}</small><br>
            <input type="checkbox" class="checkbox-auswahl">
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <!-- Umschalter & Filter -->
  <script>
    function zeigeNurNeue() {
      document.getElementById('nur-neue').classList.remove('ausblenden');
      document.getElementById('alle-artikel').classList.add('ausblenden');
    }

    function zeigeAlle() {
      document.getElementById('nur-neue').classList.add('ausblenden');
      document.getElementById('alle-artikel').classList.remove('ausblenden');
    }

    function zeigeAuswahl() {
      const etiketten = document.querySelectorAll('.etikett');
      etiketten.forEach(e => e.classList.add('ausgeblendet'));

      document.querySelectorAll('.checkbox-auswahl:checked').forEach(cb => {
        cb.closest('.etikett').classList.remove('ausgeblendet');
      });
    }

    function filterEtiketten() {
      const query = document.getElementById('suchfeld').value.toLowerCase();
      const etiketten = document.querySelectorAll('.etikett');

      etiketten.forEach(etikett => {
        const text = etikett.innerText.toLowerCase();
        if (text.includes(query)) {
          etikett.classList.remove('ausgeblendet');
        } else {
          etikett.classList.add('ausgeblendet');
        }
      });
    }
  </script>

</body>
</html>
